(function(e){e.widget("custom.combobox",{_create:function(){this.wrapper=e("<span>").addClass("custom-combobox").css("width","100%").insertAfter(this.element);this.element.hide();this._createAutocomplete();this._createShowAllButton()},_createAutocomplete:function(){var t=this.element.children(":selected"),n=t.val()?t.text():"";this.input=e("<input>").appendTo(this.wrapper).val(n).addClass("custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left").css("width","calc(100% - 30px)").autocomplete({delay:0,minLength:0,source:e.proxy(this,"_source")});this._on(this.input,{autocompleteselect:function(e,t){t.item.option.selected=true;this._trigger("select",e,{item:t.item.option})},autocompletechange:"_removeIfInvalid"})},_createShowAllButton:function(){var t=this.input,n=false;e("<a>").attr("tabIndex",-1).appendTo(this.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").css("width","30px").mousedown(function(){n=t.autocomplete("widget").is(":visible")}).click(function(){t.focus();if(n){return}t.autocomplete("search","")})},_source:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(t.term),"i");n(this.element.children("option").map(function(){var n=e(this).text();if(this.value&&(!t.term||r.test(n)))return{label:n,value:n,option:this}}))},_removeIfInvalid:function(t,n){if(n.item){return}var r=this.input.val(),i=r.toLowerCase(),s=false;boolFirst=true;intFirst=0;strFirst="";this.element.children("option").each(function(){if(boolFirst){boolFirst=false;intFirst=e(this).val();strFirst=e(this).text()}if(e(this).text().toLowerCase()===i){this.selected=s=true;return false}});if(s){return}this.input.val(strFirst);this.element.val(intFirst);this.input.autocomplete("instance").term=""},_destroy:function(){this.wrapper.remove();this.element.show()}})})(jQuery)